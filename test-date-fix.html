<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date Fix Test - Bansal Lawyers</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        #console-output { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîß Date Fix Test - Bansal Lawyers</h1>
    
    <div class="test-result info">
        <strong>Test Purpose:</strong> Verify that the DD/MM/YYYY date parsing fix works correctly
    </div>
    
    <div id="test-results">
        <div class="test-result info">Running date parsing tests...</div>
    </div>
    
    <div id="console-output"></div>
    
    <script>
        // Capture console output
        const originalConsole = {
            log: console.log,
            warn: console.warn,
            error: console.error
        };
        
        const consoleOutput = document.getElementById('console-output');
        const testResults = document.getElementById('test-results');
        
        function captureConsole(type, ...args) {
            const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : String(arg)).join(' ');
            consoleOutput.textContent += `[${type.toUpperCase()}] ${message}\n`;
            originalConsole[type](...args);
        }
        
        console.log = (...args) => captureConsole('log', ...args);
        console.warn = (...args) => captureConsole('warn', ...args);
        console.error = (...args) => captureConsole('error', ...args);
        
        // Test results
        let testsPassed = 0;
        let testsTotal = 0;
        
        function addTestResult(message, passed) {
            testsTotal++;
            if (passed) testsPassed++;
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'success' : 'error'}`;
            resultDiv.innerHTML = `<strong>${passed ? '‚úÖ' : '‚ùå'}</strong> ${message}`;
            testResults.appendChild(resultDiv);
        }
        
        // Copy the fixed functions from the book appointment page
        function parseDateFromDDMMYYYY(dateStr) {
            if (!dateStr) return null;
            
            // Split the date string by '/'
            const parts = dateStr.split('/');
            if (parts.length !== 3) {
                console.error('Invalid date format:', dateStr);
                return null;
            }
            
            // DD/MM/YYYY format: parts[0] = day, parts[1] = month, parts[2] = year
            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1; // JavaScript months are 0-based
            const year = parseInt(parts[2], 10);
            
            // Create date object
            const date = new Date(year, month, day);
            
            // Validate the date
            if (isNaN(date.getTime())) {
                console.error('Invalid date:', dateStr);
                return null;
            }
            
            return date;
        }
        
        function formatDateForInput(date) {
            // Check if date is valid
            if (!date || isNaN(date.getTime())) {
                console.error('Invalid date passed to formatDateForInput:', date);
                return 'Invalid Date';
            }
            
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        // Run tests
        function runTests() {
            console.log('üß™ Starting date parsing tests...');
            
            // Test 1: Valid DD/MM/YYYY date
            const testDate1 = '15/09/2025';
            const parsedDate1 = parseDateFromDDMMYYYY(testDate1);
            const isValid1 = parsedDate1 && !isNaN(parsedDate1.getTime());
            addTestResult(`Parse valid date "${testDate1}": ${isValid1 ? 'Success' : 'Failed'}`, isValid1);
            
            if (isValid1) {
                const formatted1 = formatDateForInput(parsedDate1);
                const roundTripSuccess = formatted1 === testDate1;
                addTestResult(`Round-trip formatting: "${testDate1}" ‚Üí "${formatted1}"`, roundTripSuccess);
            }
            
            // Test 2: Invalid date format
            const testDate2 = '15/13/2025'; // Invalid month
            const parsedDate2 = parseDateFromDDMMYYYY(testDate2);
            const isValid2 = parsedDate2 === null; // Should return null for invalid dates
            addTestResult(`Parse invalid date "${testDate2}": ${isValid2 ? 'Correctly rejected' : 'Incorrectly accepted'}`, isValid2);
            
            // Test 3: Edge case - leap year
            const testDate3 = '29/02/2024'; // Leap year
            const parsedDate3 = parseDateFromDDMMYYYY(testDate3);
            const isValid3 = parsedDate3 && !isNaN(parsedDate3.getTime());
            addTestResult(`Parse leap year date "${testDate3}": ${isValid3 ? 'Success' : 'Failed'}`, isValid3);
            
            // Test 4: Edge case - non-leap year
            const testDate4 = '29/02/2023'; // Non-leap year
            const parsedDate4 = parseDateFromDDMMYYYY(testDate4);
            const isValid4 = parsedDate4 === null; // Should return null for invalid leap year
            addTestResult(`Parse invalid leap year date "${testDate4}": ${isValid4 ? 'Correctly rejected' : 'Incorrectly accepted'}`, isValid4);
            
            // Test 5: Single digit day/month
            const testDate5 = '5/3/2025';
            const parsedDate5 = parseDateFromDDMMYYYY(testDate5);
            const isValid5 = parsedDate5 && !isNaN(parsedDate5.getTime());
            addTestResult(`Parse single digit date "${testDate5}": ${isValid5 ? 'Success' : 'Failed'}`, isValid5);
            
            // Test 6: Old broken method comparison
            const testDate6 = '15/09/2025';
            const oldMethod = new Date(testDate6);
            const newMethod = parseDateFromDDMMYYYY(testDate6);
            const oldBroken = isNaN(oldMethod.getTime());
            const newWorking = newMethod && !isNaN(newMethod.getTime());
            addTestResult(`Old method (broken): ${oldBroken ? 'Invalid Date' : 'Valid'}, New method (fixed): ${newWorking ? 'Valid' : 'Invalid'}`, oldBroken && newWorking);
            
            // Final summary
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${testsPassed === testsTotal ? 'success' : 'error'}`;
            summaryDiv.innerHTML = `<strong>Test Summary:</strong> ${testsPassed}/${testsTotal} tests passed`;
            testResults.appendChild(summaryDiv);
            
            if (testsPassed === testsTotal) {
                console.log('üéâ All date parsing tests passed! The fix is working correctly.');
            } else {
                console.error('‚ùå Some tests failed. Check the results above.');
            }
        }
        
        // Run tests when page loads
        window.addEventListener('load', runTests);
    </script>
    
    <div class="test-result info">
        <strong>Note:</strong> This test verifies that the DD/MM/YYYY date parsing fix resolves the "Invalid Date" issue in the book appointment page.
    </div>
</body>
</html>
